--[[
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
─██████████████████─██████──████████─██████──────── █████████████── ████───────────████───█████████████ ─██████────────██████████████─██████──────────██████─████████████────────
─██░░░░░░░░░░░░░░██─██░░██──██░░░░██─██░░██────────██░░░░░░░░░░░██─██░░██──────── ██░░██─██░░░░░░░░░░░██─██░░██────────██░░░░░░░░░░██─██░░██████████──██░░██─██░░░░░░░░░░██──────
─██░░██████████████─██░░██──██░░████─██░░██────────██░░███████████──██░░██───────██░░██──██░░███████████─██░░██────────██░░██████░░██─██░░░░░░░░░░██──██░░██─██░░██████░░░░██────
─██░░██─────────────██░░██──██░░██───██░░██────────██░░██───────────██░░██───────██░░██──██░░██──────────██░░██────────██░░██──██░░██─██░░██████░░██──██░░██─██░░██    ██░░░██───
─██░░██──██████████─██░░██████░░██───██░░██────────██░░███████████───██░░██─────██░░██───██░░███████████─██░░██────────██░░██████░░██─██░░██──██░░██──██░░██─██░░██     ██░░░██──
─██░░██──██░░░░░░██─██░░░░░░░░░░██───██░░██────────██░░░░░░░░░░░██───██░░██─────██░░██───██░░░░░░░░░░░██─██░░██────────██░░░░░░░░░░██─██░░██──██░░██──██░░██─██░░██      ██░░░██─
─██░░██──██████░░██─██░░██████░░██───██░░██────────██░░███████████────██░░██───██░░██────██░░███████████─██░░██────────██░░██████░░██─██░░██──██░░██──██░░██─██░░██     ██░░░██──
─██░░██──────██░░██─██░░██──██░░██───██░░██────────██░░██─────────────██░░██───██░░██────██░░██──────────██░░██────────██░░██──██░░██─██░░██──██░░██████░░██─██░░██    ██░░░██───
─██░░██████████░░██─██░░██──██░░████─██░░█████████─██░░███████████─────██░░█████░░██─────██░░███████████─██░░█████████─██░░██──██░░██─██░░██──██░░░░░░░░░░██─██░░██████░░░░██────  
─██░░░░░░░░░░░░░░██─██░░██──██░░░░██─██░░░░░░░░░░█─██░░░░░░░░░░░██─────██░░░░░░░░░██─────██░░░░░░░░░░░██─██░░░░░░░░░░█─██░░██──██░░██─██░░██──██████████░░██─██░░░░░░░░░░██──────
─██████████████████─██████──████████─█████████████─███████████████──────███████████──────███████████████─█████████████─██████──██████─██████──────────██████─████████████────────
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
─██████──────────██████─████████████████─────────────██████████████─██████─────────██████████─██████──██████─██████████████─████████████████───
─██░░██████████████░░██─██░░░░░░░░░░░░██─────────────██░░░░░░░░░░██─██░░██─────────██░░░░░░██─██░░██──██░░██─██░░░░░░░░░░██─██░░░░░░░░░░░░██───
─██░░░░░░░░░░░░░░░░░░██─██░░████████░░██─────────────██░░██████░░██─██░░██─────────████░░████─██░░██──██░░██─██░░██████████─██░░████████░░██───
─██░░██████░░██████░░██─██░░██────██░░██─────────────██░░██──██░░██─██░░██───────────██░░██───██░░██──██░░██─██░░██─────────██░░██────██░░██───
─██░░██──██░░██──██░░██─██░░████████░░██─────────────██░░██──██░░██─██░░██───────────██░░██───██░░██──██░░██─██░░██████████─██░░████████░░██───
─██░░██──██░░██──██░░██─██░░░░░░░░░░░░██─────────────██░░██──██░░██─██░░██───────────██░░██───██░░██──██░░██─██░░░░░░░░░░██─██░░░░░░░░░░░░██───
─██░░██──██████──██░░██─██░░██████░░████─────────────██░░██──██░░██─██░░██───────────██░░██───██░░██──██░░██─██░░██████████─██░░██████░░████───
─██░░██──────────██░░██─██░░██──██░░██───────────────██░░██──██░░██─██░░██───────────██░░██───██░░░░██░░░░██─██░░██─────────██░░██──██░░██─────
─██░░██──────────██░░██─██░░██──██░░██████─██████────██░░██████░░██─██░░██████████─████░░████─████░░░░░░████─██░░██████████─██░░██──██░░██████─
─██░░██──────────██░░██─██░░██──██░░░░░░██─██░░██────██░░░░░░░░░░██─██░░░░░░░░░░██─██░░░░░░██───████░░████───██░░░░░░░░░░██─██░░██──██░░░░░░██─
─██████──────────██████─██████──██████████─██████────██████████████─██████████████─██████████─────██████─────██████████████─██████──██████████─
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
]]--

local usingLimit = false

RegisterCommand('fart', function(source, args, rawCommand)
    local playerPed = PlayerPedId()
    local veh = GetVehiclePedIsIn(playerPed, false)
    local maxSpeed = GetVehicleHandlingFloat(veh,"CHandlingData","fInitialDriveMaxFlatVel")
    local fart = args[1]

    if IsPedInAnyVehicle(playerPed, false) then
        if GetPedInVehicleSeat(veh, -1) then
            if fart == '50' then
                SetVehicleMaxSpeed(veh, 13.888889)
                exports['t-notify']:Alert({
                    style = 'info', 
                    message = 'Begrænsning sat til 50 km/t.'
                })
                exports['t-notify']:Alert({
                    style = 'info', 
                    message = 'Fart Begrænser: Tryk X for at slå fra'
                })
                usingLimit = true
            elseif fart == '80' then
                SetVehicleMaxSpeed(veh, 22.222222)
                exports['t-notify']:Alert({
                    style = 'info', 
                    message = 'Begrænsning sat til 80 km/t.'
                })
                exports['t-notify']:Alert({
                    style = 'info', 
                    message = 'Fart Begrænser: Tryk X for at slå fra'
                })
                usingLimit = true
            elseif fart == '100' then
                SetVehicleMaxSpeed(veh, 27.777778)
                exports['t-notify']:Alert({
                    style = 'info', 
                    message = 'Begrænsning sat til 100 km/t.'
                })
                exports['t-notify']:Alert({
                    style = 'info', 
                    message = 'Fart Begrænser: Tryk X for at slå fra'
                })
                usingLimit = true
            elseif fart == '130' then
                SetVehicleMaxSpeed(veh, 36.111111)
                exports['t-notify']:Alert({
                    style = 'info', 
                    message = 'Begrænsning sat til 130 km/t.'
                })
                exports['t-notify']:Alert({
                    style = 'info', 
                    message = 'Fart Begrænser: Tryk X for at slå fra'
                })
                usingLimit = true
            elseif fart == nil and usingLimit then
                SetVehicleMaxSpeed(veh, maxSpeed)
                exports['t-notify']:Alert({
                    style = 'info', 
                    message = 'Fart Begrænser: Tryk X for at slå fra'
                })
                usingLimit = false
            elseif fart == nil then
                exports['t-notify']:Alert({
                    style = 'info', 
                    message = 'Fart Begrænser: Du kan vælge mellem 50, 80, 100 og 130 km/t'
                }) 
            else
                exports['t-notify']:Alert({
                    style = 'info', 
                    message = 'Fart Begrænser: Du kan vælge mellem 50, 80, 100 og 130 km/t'
                }) 
            end
        else 
            exports['t-notify']:Alert({
                style = 'error', 
                message = 'Du skal være på førersædet!'
            })
        end
    else
        exports['t-notify']:Alert({
            style = 'error', 
            message = 'Du er ikke i et køretøj!'
        })
    end
    Citizen.Wait(1)

    while usingLimit == true do
        Citizen.Wait(1)
        if IsControlJustPressed(0, 105) then
            SetVehicleMaxSpeed(veh, maxSpeed)
            exports['t-notify']:Alert({
                style = 'error', 
                message = 'Fart Begrænseren er blevet slået fra.'
            })
            usingLimit = false
        end
    end
end)
